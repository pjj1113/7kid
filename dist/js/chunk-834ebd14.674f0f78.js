(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-834ebd14"],{"0b09":function(t,e,i){t.exports=i.p+"img/chaoshi_icon.ccec4962.png"},"0e15":function(t,e,i){t.exports=i.p+"img/wechat_btn.57ff9a38.png"},"2df5":function(t,e,i){"use strict";var a=i("9b16"),n=i("fc3a"),o=i("4340"),s=i("e74f"),r=i("5fd8");a("search",1,(function(t,e,i){return[function(e){var i=o(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,i):new RegExp(e)[t](String(i))},function(t){var a=i(e,t,this);if(a.done)return a.value;var o=n(t),c=String(this),u=o.lastIndex;s(u,0)||(o.lastIndex=0);var d=r(o,c);return s(o.lastIndex,u)||(o.lastIndex=u),null===d?-1:d.index}]}))},"3b95":function(t,e,i){t.exports=i.p+"img/jieshu_icon.dfe12728.png"},5199:function(t,e,i){"use strict";i("a543"),i("e583"),i("0bd5"),i("836b"),i("5a4c"),i("2df5");e["a"]={myBrowser:function(t){var e=navigator.userAgent;switch(t){case"ie":if(e.indexOf("MSIE")>=1){var i=new RegExp("MSIE (\\d+\\.\\d+);");return i.test(e),parseFloat(RegExp["$1"])}return e.indexOf("Edge")>-1?"Edge":window.ActiveXObject||"ActiveXObject"in window||e.search(/Trident/i)?11:0;case"wx":return"micromessenger"==e.toLowerCase().match(/MicroMessenger/i);case"ios":return/(iPhone|iPad|iPod|iOS)/i.test(e);case"android":return/(Android)/i.test(e);case"pc":return!e.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);case"windows":return e.indexOf("Windows")>-1;case"mac":return e.indexOf("Mac")>-1;default:return 0}}}},"6dd7":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAADuklEQVRIS62XV6idVRCFv2XHGhvWBxVRMfFBRcWK/UHFGBBsEH0ydiLYC7aABmIJGrBAVEQffBA1BgvEkKCiCBqMXbDEEqyoaDSWLFlhzvXek3vz73N13s759561Z/bMWrNFg9neADgFOAA4FtgZWA94Dzha0u8NbkYs0do22N4KuBS4ANgS6F//B7CHpM/+N2DbpwH3ANuUUwM/AfOBj4BfgCWSFgwKmvVrRGx7HeB24KJKZwCfAe4EFklaNR6g/j0jgAv0KeDEOtS7wDRJLw0CZntPYB6wGXCEpGRo7Du2PRu4uFa8AJwqKSkdyGynAAO8EfAJcKik5cOdDEVs+yzgoUrv88AJLWm1vTkwFTgQ2LEqfltgE2DDAntdUr4P2Wpg2ymgD4BU8dvAwS2R2s6V3FsFmOjGslWS1h0N+FbgqpwBOFzSy125tX0k8GylMwX3K/Aa8B3wZ/ob2Kl8LpaU9f9GbDsn/ar69ElJUxpAU/nvAHsBPwI3AnMk/VUZTObS20n358Ahkr7sBz4DeLT+zIJXG4BPAp4GfgBmSbpt+B7bu9aVhdGSwXTHyKq2nf6cDnwtafsu0IpoTrFZKnYfSUnzCLN9HLBMUmpnDZPtpcAk4GFJ5zQCJ817A/dLmtayZ7SIv69qvkHSzS1ObK8AUqWzJV3RsqcytT4wGXgjEYd/04uXSQpVdprtFNE3wIOSru3cUAtsp3NuApYHOFW5BXC5pFktTmynfVK1AW7KUkUc0bkQWBHgb4sAZki6vhF4SV3P6ZJeadlTwI8B6aIvApymD53Nk3Ryq5PxrLMdsdgdeDHAtwDXASuBCeOZJloOYXsX4P3i75kBDt9GCsNGSd3jLY4GXWP7amBGye1RAU5bLCtleVPSfoM67VpfChb2Cnd/CuzWU6f0Yo/2zpb0SJezQb7bTuVfU9FOl3R3D3hT4C0gHPszcJCk3Md/NttRqcxpEaMUVyh25fBBIHf9BJBRNvx6mKRI3LitRqCFwA5VvMdLWhyH/TPXlUDSEvDcxWRJycTAViKRK9uuNPl8Sff1HPUD5/dc4MwC/60o7g5JEfdOsz0BSAVnHg83Z7iYKSn/DdmoA31xasS9NzNlULsrut0v6MVI8bM/kCHivGHDf/T4EkkP9J94zJeE7ahIuDuNn+fKaowSh1BmDpPeT4vsW3zfm6v+Bj4Ezh1rNO56wkS1EkGG+62BjTtynev4uLIzV1KeOKPaWoF7O2wn4mMynNecNTH0CkSlouchhzzgnmsZneL3H7EXYXVtLm01AAAAAElFTkSuQmCC"},"8abc":function(t,e,i){"use strict";var a,n=i("28f8"),o=i("d722");e["a"]=(a={uploadFile:function(t){return Object(o["b"])("/file/v1/file/upload/binary",t,{headers:{"Content-Type":"multipart/form-data"}})},addVisitant:function(t,e){return Object(o["b"])("/visitor/v1/applicationRecord/applicationAdd",t,{headers:{"Content-Type":"application/json"}},e)},addVisitantTeacher:function(t,e){return Object(o["b"])("/visitor/v1/applicationRecord/TeacherAdd",t,{headers:{"Content-Type":"application/json"}},e)},applicationDetails:function(t){return Object(o["b"])("/visitor/v1/applicationRecord/getById",t)},applicationAgree:function(t){return Object(o["b"])("/visitor/v1/applicationRecord/agree",t)},applicationRefuse:function(t){return Object(o["b"])("/visitor/v1/applicationRecord/refuse",t)},sendSmsCode:function(t){return Object(o["b"])("/message/v1/sms/send-sms-code",t)},verifySmsCodSe:function(t){return Object(o["b"])("/message/v1/sms/verify-sms-code",t)},getSchoolInfo:function(t){return Object(o["b"])("/visitor/v1/applicationRecord/getSchoolInfo",t)},getVisitorTeacherInfo:function(t){return Object(o["b"])("/visitor/v1/applicationRecord/getTeacherInfo",t)},teacherLogin:function(t){return Object(o["b"])("/iam/v1/web-oauth/kid-login/teacher-login",t)},getVisitantDetail:function(t){return Object(o["b"])("/visitor/v1/visitor/record/get-by-id",t)}},Object(n["a"])(a,"applicationRefuse",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/refuse",t)})),Object(n["a"])(a,"applicationAgree",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/agree",t)})),Object(n["a"])(a,"delayDate",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/delay-time",t)})),Object(n["a"])(a,"addAccessRecord",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/add-access-record",t)})),Object(n["a"])(a,"visitantGoSchool",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/entry-school",t)})),Object(n["a"])(a,"visitantOutSchool",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/out-school",t)})),Object(n["a"])(a,"qrCodeInfo",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/get-qr-code-info",t)})),Object(n["a"])(a,"verifyQrCode",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/verify-qr-code-info",t)})),Object(n["a"])(a,"cardType",(function(t){return Object(o["b"])("/visitor/v1/option/cardType",t)})),Object(n["a"])(a,"wechatShare",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/get-wechat-share-info",t)})),Object(n["a"])(a,"smsInvite",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/sms-invite",t)})),Object(n["a"])(a,"applicationList",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/applicationList",t)})),Object(n["a"])(a,"getVisitantList",(function(t){return Object(o["b"])("/visitor/v1/visitor/record/query-list",t,{headers:{"Content-Type":"application/json"}})})),Object(n["a"])(a,"getCheckList",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/applicationList",t)})),Object(n["a"])(a,"getNoCheckNum",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[30];return Object(o["b"])("/visitor/v1/teacher/msg/unread",t,{headers:{"Content-Type":"application/json"}})})),Object(n["a"])(a,"getYesCheckList",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/yesApprovalList",t)})),Object(n["a"])(a,"getNoCheckList",(function(t){return Object(o["b"])("/visitor/v1/applicationRecord/noApprovalList",t)})),Object(n["a"])(a,"getCodeConfing",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["b"])("/visitor/v1/application/backgroundConfig",t)})),a)},9813:function(t,e,i){t.exports=i.p+"img/duanxin_btn.a58c8bf8.png"},a7d6:function(t,e,i){"use strict";i("f257")},ae41:function(t,e,i){t.exports=i.p+"img/shixiao_icon.05b49fda.png"},d2d6:function(t,e,i){},da1d:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-nav-bar",{attrs:{title:t.t_title,fixed:"",border:t.border}},[t._t("left",[i("van-icon",{staticClass:"nav-go",attrs:{name:"arrow-left"},on:{click:t.onClickLeft}})],{slot:"left"}),t._t("title",null,{slot:"title"}),t._t("right",null,{slot:"right"})],2)},n=[],o=i("2939"),s={computed:{t_title:function(){return this.title?this.title:/.*[\u4e00-\u9fa5]+.*$/.test(this.$route.meta.title)?this.$route.meta.title:this.$t("route.".concat(this.$route.meta.title))}},props:{border:{type:Boolean,default:!0},onlyBack:{type:Boolean,default:!1},title:{type:String}},methods:{onClickLeft:function(){this.onlyBack||o["a"].closeWebview(),this.$router.go(-1)}}},r=s,c=(i("a7d6"),i("c701")),u=Object(c["a"])(r,a,n,!1,null,"2f4d49ad",null);e["a"]=u.exports},e583:function(t,e,i){var a=i("aba0"),n=i("8d5c"),o=i("0ef8"),s=i("6564"),r=i("22af").f,c=i("3de6").f,u=i("00a5"),d=i("9ffc"),l=i("6fe2"),f=i("4450"),v=i("2bc8"),p=i("891c").set,h=i("6d96"),b=i("1f17"),g=b("match"),m=n.RegExp,w=m.prototype,y=/a/g,O=/a/g,A=new m(y)!==y,B=l.UNSUPPORTED_Y,C=a&&o("RegExp",!A||B||v((function(){return O[g]=!1,m(y)!=y||m(O)==O||"/a/i"!=m(y,"i")})));if(C){var j=function(t,e){var i,a=this instanceof j,n=u(t),o=void 0===e;if(!a&&n&&t.constructor===j&&o)return t;A?n&&!o&&(t=t.source):t instanceof j&&(o&&(e=d.call(t)),t=t.source),B&&(i=!!e&&e.indexOf("y")>-1,i&&(e=e.replace(/y/g,"")));var r=s(A?new m(t,e):m(t,e),a?this:w,j);return B&&i&&p(r,{sticky:i}),r},S=function(t){t in j||r(j,t,{configurable:!0,get:function(){return m[t]},set:function(e){m[t]=e}})},k=c(m),D=0;while(k.length>D)S(k[D++]);w.constructor=j,j.prototype=w,f(n,"RegExp",j)}h("RegExp")},e74f:function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},f06f:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"record-comp"},[a("div",{staticClass:"visit-reason"},[t.statusIcon?a("img",{staticClass:"status",attrs:{src:t.imgUrl}}):t._e(),a("h3",[t._v("访问事由")]),a("van-cell-group",{attrs:{border:!1}},[a("van-cell",{attrs:{title:"访问事由",label:t.visitorReason}}),a("van-cell",{attrs:{title:"开始时间",value:t.beginTime}}),a("van-cell",{attrs:{title:"结束时间",value:t.endTime}}),a("van-cell",{attrs:{title:"接待人",value:t.receptionName}}),a("van-cell",{attrs:{title:"接待老师手机号",value:t.receptionPhone}})],1),a("h3",[t._v("访问信息")]),a("van-cell-group",{attrs:{border:!1}},[a("van-cell",{attrs:{title:"姓名",value:t.visitorName}}),a("van-cell",{attrs:{title:"手机号",value:t.visitorPhone}}),a("van-cell",{attrs:{title:"证件类型",value:t.cardType}}),a("van-cell",{attrs:{title:"证件号码",value:t.cardNo}}),a("div",{staticClass:"content-img"},[a("p",[t._v("二维码通行证")]),a("vue-qr",{attrs:{text:t.downloadData.url,logoSrc:t.downloadData.icon,logoScale:.23,size:300},nativeOn:{click:function(e){t.qrCodeShow=!0}}}),t.showBtn&&!t.statusImg?a("div",{staticClass:"btn-share"},[a("img",{attrs:{src:i("6dd7")}}),a("van-button",{attrs:{round:"",size:"large",color:"linear-gradient(to right, #79DABD, #4CD7EC)",type:"button"},on:{click:t.share}},[t._v("分享给客人")])],1):t._e()],1),t.imagesList[0]?a("div",{staticClass:"content-img"},[a("p",[t._v("现场照片")]),a("div",{staticClass:"swiper"},[a("van-swipe",{attrs:{"indicator-color":"#27CBBB",width:"270",height:"270"}},t._l(t.imagesList,(function(e,i){return a("van-swipe-item",{key:i},[a("img",{attrs:{src:e},on:{click:function(e){return t.previewImg(t.imagesList,i)}}})])})),1)],1)]):t._e()],1)],1),0==t.status||1==t.status||2==t.status?a("div",{directives:[{name:"permission",rawName:"v-permission",value:["school-visitor-manage-visitor-record-update"],expression:"['school-visitor-manage-visitor-record-update']"}],staticClass:"btn-sub"},[0==t.status?a("van-button",{attrs:{round:"",plain:"",size:"large",color:"#27CBBB",type:"info"},on:{click:t.addAccessRecord}},[t._v("访客入园")]):t._e(),1==t.status?a("van-button",{attrs:{round:"",plain:"",size:"large",color:"#27CBBB",type:"info"},on:{click:t.addAccessRecord}},[t._v("访客离园")]):t._e(),2==t.status?a("van-row",{attrs:{justify:"center"}},[a("van-col",{attrs:{span:"11"}},[a("van-button",{attrs:{round:"",plain:"",hairline:"",block:"",color:"#27CBBB",type:"info"},on:{click:t.delayDateShow}},[t._v("延长时间")])],1),a("van-col",{attrs:{span:"2"}}),a("van-col",{attrs:{span:"11"}},[a("van-button",{attrs:{round:"",plain:"",hairline:"",block:"",color:"#27CBBB",type:"info"},on:{click:t.addAccessRecord}},[t._v("访客离园")])],1)],1):t._e()],1):t._e(),a("van-popup",{style:{height:"30%"},attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t.showBtn?a("div",{staticClass:"share-content"},[a("div",{staticClass:"share-icon"},[a("div",{attrs:{id:"share"},on:{click:t.shareWechat}},[a("img",{attrs:{src:i("0e15")}}),a("span",[t._v("微信分享")])]),a("div",{on:{click:t.smsInvite}},[a("img",{attrs:{src:i("9813")}}),a("span",[t._v("短信发送")])])]),a("a",{attrs:{id:"sms",href:t.sms}}),a("div",{staticClass:"share-off"},[a("van-button",{attrs:{type:"default",block:""},on:{click:t.shareOff}},[t._v("取消")])],1)]):t._e()]),a("van-dialog",{attrs:{confirmButtonColor:"#48D4C6",confirmButtonText:"提交","show-cancel-button":""},on:{confirm:t.delayDate},model:{value:t.delayDateBox,callback:function(e){t.delayDateBox=e},expression:"delayDateBox"}},[a("div",{staticClass:"delay-date-box"},[a("h3",[t._v("确认延长结束时间")]),a("p",{staticClass:"date-box-title"},[t._v("延时后，访客将被允许继续留园")]),a("div",{staticClass:"date-box-info"},[a("p",[t._v("请选择时长：")]),a("div",t._l(t.delayDateArr,(function(e,i){return a("span",{key:i,class:t.duration==e&&"active",on:{click:function(i){return t.updateDelayDate(e)}}},[t._v(t._s(e%60?e%60+"分钟":e/60+"小时"))])})),0)])])]),a("van-overlay",{staticClass:"preview-popup",attrs:{show:t.qrCodeShow},on:{click:function(e){t.qrCodeShow=!1}}},[a("div",{staticClass:"qrcode-block"},[a("vue-qr",{attrs:{text:t.downloadData.url,logoSrc:t.downloadData.icon,logoScale:.23,size:300}})],1)])],1)},n=[],o=(i("445a"),i("cb3c"),i("72b3"),i("402f"),i("0bd5"),i("9b42"),i("270f"),i("f354"),i("f73a")),s=(i("3f27"),i("8048")),r=(i("6a61"),i("2e91")),c=i("8abc"),u=i("5199"),d=i("d092"),l=i.n(d),f=i("ad2b"),v=i("2939"),p={data:function(){return{show:!1,delayDateBox:!1,visitorReason:"",receptionName:"",receptionPhone:"",beginTime:"",endTime:"",visitorName:"",visitorPhone:"",cardType:"",cardNo:"",status:"",statusImg:!1,statusIcon:!1,imgUrl:"",delayDateArr:[60,120,240],duration:30,sceneImg:"",cardTypeList:null,userInfo:"",sms:"sms:",showPicture:!1,imagesList:[],id:"",downloadData:{url:"",icon:""},showBtn:!0,qrCodeShow:!1,requesting:!1}},components:{vueQr:l.a},watch:{status:function(t){switch(t){case 0:this.imgUrl="",this.statusImg=!1,this.statusIcon=!1;case 1:this.imgUrl="",this.statusImg=!1,this.statusIcon=!1;break;case 2:this.imgUrl=i("0b09"),this.statusImg=!1,this.statusIcon=!0;break;case 3:this.imgUrl=i("3b95"),this.statusImg=!0,this.statusIcon=!0;break;case 4:this.imgUrl=i("ae41"),this.statusImg=!0,this.statusIcon=!0;break}},sceneImg:function(t){var e=this;t&&t.forEach((function(t){t.fileInfoVO&&(e.imagesList.push(t.fileInfoVO.url),e.showPicture=!0)}))}},mounted:function(){v["a"].getAppData(),this.userInfo=localStorage.getItem("jsBridgeInfo")&&JSON.parse(localStorage.getItem("jsBridgeInfo"))||"",this.getVisitantDetail(),this.id=this.$route.query.id?this.$route.query.id:this.userInfo.id,this.userInfo.refreshToken?this.showBtn=!1:this.showBtn=!0},methods:{getVisitantDetail:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["a"].cardType().then((function(e){t.cardTypeList=e.data}));case 2:return e.next=4,c["a"].getVisitantDetail({id:t.id}).then((function(e){t.visitorReason=e.data.visitorReason,t.receptionName=e.data.receptionName,t.receptionPhone=e.data.receptionPhone,t.beginTime=Object(f["a"])(e.data.beginTime),t.endTime=Object(f["a"])(e.data.endTime),t.visitorName=e.data.visitorName,t.visitorPhone=e.data.visitorPhone;var i=t.cardTypeList.filter((function(t){return e.data.cardType==t.cardType}));t.cardType=i[0].cardTypeName,t.cardNo=e.data.cardNo,t.status=e.data.status,t.sceneImg=e.data.accessRecords}));case 4:c["a"].qrCodeInfo({id:t.id}).then((function(e){t.downloadData.icon=e.data.schoolLogoUrl?e.data.schoolLogoUrl:"",t.downloadData.url=JSON.stringify({businessType:1,data:{id:e.data.id,timestamp:e.data.timestamp}})})),c["a"].smsInvite({id:t.id}).then((function(e){u["a"].myBrowser("ios")?t.sms="sms:".concat(t.visitorPhone,"&body=").concat(e.data):(t.sms="sms:".concat(t.visitorPhone,"?body=").concat(e.data),t.sms=t.sms.replace("#","%23"))}));case 6:case"end":return e.stop()}}),e)})))()},share:function(){this.show=!0},shareOff:function(){this.show=!1},shareWechat:function(){var t=this;c["a"].wechatShare({id:this.id}).then((function(e){v["a"].wechatShare(JSON.stringify({title:e.data.title,appIcon:e.data.schoolLogo,targetUrl:e.data.targetUrl,content:e.data.content})),t.shareOff()}))},smsInvite:function(){var t=this;s["a"].confirm({title:"是否发送短信分享",message:"点击确定将邀请二维码发送到访客的手机号"}).then((function(){document.getElementById("sms").click(),t.show=!1})).catch((function(){}))},updateDelayDate:function(t){this.duration=t},delayDateShow:function(){this.delayDateBox=!0},delayDate:function(){var t=this;this.requesting||(this.requesting=!0,c["a"].delayDate({id:this.id,duration:this.duration}).then((function(e){t.getVisitantDetail(),v["a"].visitorsRefreshStatus(),Toast("操作成功")})).finally((function(){setTimeout((function(){t.requesting=!1}),800)})))},previewImg:function(t,e){Object(o["a"])({images:t,showIndex:!0,loop:!1,startPosition:e})},addAccessRecord:function(){var t=this;s["a"].confirm({title:"".concat(this.status?"确认访客离园？":"确认访客入园？"),message:"".concat(this.status?"访客离园后，本次拜访将 结束！":"同意入园后，访客记录状态将更新为已入园！")}).then((function(){c["a"].addAccessRecord({id:t.id}).then((function(e){t.getVisitantDetail(),v["a"].visitorsRefreshStatus(),Toast("操作成功")}))})).catch((function(){}))}}},h=p,b=(i("f6ff"),i("c701")),g=Object(b["a"])(h,a,n,!1,null,null,null);e["a"]=g.exports},f257:function(t,e,i){},f6ff:function(t,e,i){"use strict";i("d2d6")}}]);