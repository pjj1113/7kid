(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-47249579"],{"2e1f":function(e,t,i){},"36e5":function(e,t,i){"use strict";var s=i("c301"),n=i("b420");e.exports=s("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n)},"4e191":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"group"},[s("nav-bar",{attrs:{title:"修改任务"},scopedSlots:e._u([{key:"left",fn:function(){return[s("van-icon",{staticClass:"nav-go",attrs:{name:"arrow-left"},on:{click:e.onClickLeft}})]},proxy:!0},{key:"right",fn:function(){return[s("span",{staticClass:"van-right",on:{click:e.publish}},[s("span",{class:{rightBtn:e.unclick}},[e._v(e._s(e.$t("polling.publish")))])])]},proxy:!0}])}),s("div",{staticClass:"content",staticStyle:{"padding-top":"47px"}},[s("van-form",[s("van-field",{attrs:{name:e.$t("polling.userName"),label:e.$t("polling.taskName"),"input-align":"right",placeholder:e.$t("polling.inputTaskName"),required:"",maxlength:"12"},on:{input:e.inputText},model:{value:e.requestBody.jobName,callback:function(t){e.$set(e.requestBody,"jobName",t)},expression:"requestBody.jobName"}}),s("div",{staticClass:"van-hairline--bottom",staticStyle:{display:"flex","padding-left":"10px"}},[s("img",{staticStyle:{width:"7px",height:"45px",margin:"19px 5px 2px 0px"},attrs:{src:i("9f33")}}),s("div",{staticStyle:{width:"100%"}},[s("van-field",{attrs:{readonly:"",clickable:"",required:"",name:"picker",label:e.people,value:e.picker,"input-align":"right",placeholder:e.$t("polling.notDesignatedTask"),"right-icon":"arrow"},on:{click:function(t){return e.selectPerson("人员",e.requestBody.jobType)}}}),s("van-field",{attrs:{readonly:"",required:"",clickable:"",name:"picker",label:e.$t("polling.target"),value:e.points,"input-align":"right",placeholder:e.$t("polling.selectTarget"),"right-icon":"arrow"},on:{click:e.selectPointMethod}})],1)]),s("van-action-sheet",{attrs:{actions:e.actions,"cancel-text":e.$t("polling.cancle"),"close-on-click-action":""},on:{select:e.selectPerson,cancel:function(t){e.showPersonPop=!1}},model:{value:e.showPersonPop,callback:function(t){e.showPersonPop=t},expression:"showPersonPop"}}),s("selectPerson",{attrs:{showSelectPerson:e.showSelectPerson,managers:e.managers,selectPersons:e.selectPersons,isTeam:e.isTeam,oldJobType:e.jobType,groupUserIds:e.groupUserIds},on:{cancle:e.cancle,selectPersonFinish:e.selectPersonFinish}}),s("selectPoint",{attrs:{showSelectPoint:e.showSelectPoint,selectPoint:e.selectPoint,groupUserIds:e.groupUserIds,groupUserNames:e.picker,jobType:e.jobType},on:{selectPointListener:e.selectPointListener,cancle:e.cancle}}),s("van-field",{attrs:{readonly:"",clickable:"",required:"",name:"picker",label:e.$t("polling.cycle"),value:e.tt,"input-align":"right",placeholder:e.$t("polling.setTaskNotice"),"right-icon":"arrow"},on:{click:e.selectTask}}),s("van-field",{attrs:{readonly:"",clickable:"",required:"",name:"picker",value:e.xuanzecishu,label:e.$t("polling.times"),"input-align":"right",placeholder:e.$t("polling.setTimesAndCorresponding"),"right-icon":"arrow"},on:{click:function(t){e.showChoiceTime=!0}}}),s("choiseTime",{attrs:{showChoiceTime:e.showChoiceTime,times:e.cishu},on:{choiceCishu:e.choiceCishu,cancle:e.cancle}}),s("van-field",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"},attrs:{name:"switch",label:e.$t("polling.InspectInOrder"),"label-width":"200px","input-align":"right"},scopedSlots:e._u([{key:"input",fn:function(){return[s("van-switch",{attrs:{size:"20","active-color":"#4CD7EC","inactive-color":"#ffffff"},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})]},proxy:!0}])}),s("selectTime",{attrs:{showSelectTime:e.showSelectTime,selectDate1:e.selectDate,tabIndex:e.tabIndex,tt:e.tt},on:{selectText:e.selectText,cancle:e.cancle}}),s("div",{staticClass:"beizhu"},[s("p",[e._v(e._s(e.$t("polling.Comments")))]),s("div",{staticClass:"remarkinput"},[s("van-field",{attrs:{rows:"3",autosize:"",border:!1,type:"textarea","show-word-limit":"",placeholder:e.$t("polling.EnterComments"),maxlength:"50"},model:{value:e.requestBody.remark,callback:function(t){e.$set(e.requestBody,"remark",t)},expression:"requestBody.remark"}})],1)]),s("div",{staticClass:"file-upload"},[s("uploader",{ref:"uploader",attrs:{fileList:e.fileList,uploaderFlag:!0,mediaSheetActions:e.mediaSheetActions}})],1)],1)],1)],1)},n=[],o=(i("445a"),i("cb3c"),i("72b3"),i("a543"),i("cca2"),i("6540"),i("b131"),i("1d7a"),i("402f"),i("0bd5"),i("36e5"),i("2db5"),i("9b42"),i("79a8"),i("270f"),i("6ab7"),i("7336"),i("b08c")),r=i("4c09"),a=i("da1d"),c=i("59bc"),l=i("52b3"),u=i("040a"),h=i("ebb8"),d=i("0319"),p=i("2939"),f=i("8234"),m={name:"polling-management-swpw",mounted:function(){var e=this;this.getDetils(),window.kidBackPress=function(){return!!(e.showSelectTime||e.showChoiceTime||e.showSelectPoint||e.showPersonPop||e.showSelectPerson)&&(e.cancle(),!0)}},components:{selectTime:c["a"],choiseTime:l["a"],selectPerson:u["a"],selectPoint:h["a"],uploader:f["a"],navBar:a["a"],vantUpload:f["a"]},beforeRouteEnter:function(e,t,i){"polling-index"==t.name||"polling-management"==t.name||"wristband-equipmentManage"==t.name||t.name,!1,i()},activated:function(){this.getDetils(),this.$forceUpdate()},data:function(){return{jobId:this.$route.query.jobId,requestBody:{jobName:"",remark:""},showSelectTime:!1,selectDate:[],people:this.$t("polling.person"),showChoiceTime:!1,showPersonPop:!1,showSelectPerson:!1,showSelectPoint:!1,indexs:1,checked:!1,inputCheck:1,isTeam:!1,Taskvalue:"",publishing:!1,picker:"",unclick:!0,points:"",fromMain:!1,tt:"",xuanzecishu:"",cishu:[],selectPersons:[[]],selectPoint:[],groupUserIds:[],jobType:1,actions:[{name:this.$t("polling.IndividualTasks")},{name:this.$t("polling.TeamTasks")}],fileList:[],mediaSheetActions:[{name:this.$t("polling.photo")},{name:this.$t("polling.video")},{name:this.$t("polling.photoFromAlbum")},{name:this.$t("polling.videoFromAlbum")}],tabIndex:0,managers:[]}},methods:{getDetils:function(){var e=this;d["a"].getCycleTaskDetail({jobId:this.$route.query.jobId}).then((function(t){var i=t.data,s=i.managers,n=i.jobName,o=i.users,a=(i.issuerName,i.targets),c=i.jobType,l=i.points,u=i.times,h=i.jobConfDate,p=i.cycleType,f=i.jobConfDateName,m=i.sortFlag,g=i.remark,y=i.resources;e.requestBody.jobName=n,e.isTeam=2!=c,e.picker=Object(r["a"])(Object(r["a"])(o.filter((function(e){return!e.isDeleted}))).map((function(e){return e.userName}))).join("，"),d["a"].groupUserOption({}).then((function(t){e.groupUserIds=[];var i=Object(r["a"])(o.filter((function(e){return!e.isDeleted}))).map((function(e){return e.userId})),n=Object(r["a"])(new Set(o.map((function(e){return e.groupId}))));if(e.isTeam)var a=Object(r["a"])(s.filter((function(e){return!e.isDeleted}))).map((function(e){return e.userId})),c=Object(r["a"])(new Set(s.map((function(e){return e.groupId}))));t.data.forEach((function(t){n.join(" ").indexOf(t.groupId)>=0&&t.users.forEach((function(t){i.join(" ").indexOf(t.userId)>=0&&e.groupUserIds.push(t.id)})),e.isTeam&&c.join(" ").indexOf(t.groupId)>=0&&t.users.forEach((function(t){a.join(" ").indexOf(t.userId)>=0&&(e.$set(e.requestBody,"inChargeGroupUserIds",[]),e.requestBody.inChargeGroupUserIds.push(t.id),console.log(e.requestBody.inChargeGroupUserIds,999))}))})),e.$set(e.requestBody,"groupUserIds",e.groupUserIds),e.detailInfoData=JSON.stringify(e.requestBody)})),e.managers=s.filter((function(e){return!e.isDeleted})),e.jobType=c,e.requestBody.jobType=c,e.points=l,e.selectPoint=Object(r["a"])(a.filter((function(e){return!e.isDeleted}))).map((function(e){return{patrolGroups:null,pointId:e.targetId,pointName:e.targetName,select:!0}})),e.requestBody.targets=Object(r["a"])(a.filter((function(e){return!e.isDeleted}))).map((function(e,t){return{targetId:e.targetId,targetSort:t+1,targetType:e.targetType}})),e.points=Object(r["a"])(Object(r["a"])(a.filter((function(e){return!e.isDeleted}))).map((function(e){return e.targetName}))).join(","),e.tabIndex=1,e.cishu=u.map((function(e){return{endTime:e.endTime,hasData:!0,startTime:e.startTime,time:"".concat(e.startTime,"~").concat(e.endTime),title:"巡检".concat(e.timeSort)}})),e.requestBody.times=u.map((function(e){return{endTime:e.endTime.slice(0,5),startTime:e.startTime.slice(0,5)}})),e.requestBody.cycleType=p,e.xuanzecishu=e.$t("polling.hasSelect"),e.requestBody.jobConfDate=h,e.tt=f,e.checked=m,e.requestBody.remark=g,e.fileList=y,e.$nextTick((function(){e.detailInfoData=JSON.stringify(e.requestBody)}))}))},cancle:function(){this.showSelectTime=!1,this.showChoiceTime=!1,this.showSelectPerson=!1,this.showSelectPoint=!1},inputText:function(e){this.inputCheck=e.length+100},selectPerson:function(e,t){this.isTeam=2!=t,this.showSelectPerson=!0,this.showPersonPop=!1,this.inputCheck=1},selectPointMethod:function(){this.groupUserIds.length<=0?Object(o["a"])(this.$t("polling.notSelectedTheTaskPerson")):this.showSelectPoint=!0},selectPersonFinish:function(e,t){var i=this;this.selectPersons=e,this.requestBody.groupUserIds=[];var s=[],n=!1;e.forEach((function(e){e.users.forEach((function(e){e.select&&(s.push(e.realName),i.requestBody.groupUserIds.push(e.id)),i.isTeam&&t.id==e.id&&(n=!0)}))})),this.isTeam&&(this.requestBody.inChargeGroupUserIds=[],this.requestBody.inChargeGroupUserIds.push(t.id)),null!=this.requestBody.targets&&this.requestBody.targets.length>0&&(this.$toast("任务人员已变动，请重新选择任务目标！"),this.points="",this.selectPoint=[]),this.groupUserIds=this.requestBody.groupUserIds,this.picker=s.join(","),!n&&this.isTeam&&(this.picker=this.picker+","+t.realName),this.jobType=this.isTeam?1:2,this.people=this.isTeam?this.$t("polling.teamType"):this.$t("polling.personType"),this.requestBody.jobType=this.isTeam?1:2,this.inputCheck=2,this.showSelectPerson=!1},getExistFile:function(e){var t=null;return this.fileList.forEach((function(i){i.id==e.id&&(t=i)})),t},selectPointListener:function(e){var t=this;this.selectPoint=e,this.requestBody.targets=[];var i=[];e.forEach((function(e,s){var n={targetId:e.pointId,targetSort:s,targetType:1};i.push(e.pointName),t.requestBody.targets.push(n)})),this.points=i.join(","),this.showSelectPoint=!1,this.inputCheck=3},selectTask:function(){this.showSelectTime=!0},selectText:function(e,t){this.requestBody.cycleType=t;var i=[];if(1==t){var s=e.map((function(e){return i.push(e.text),e.index}));this.requestBody.jobConfDate=s.join(","),this.selectDate=[]}else this.selectDate=e,e.forEach((function(e){i.push(e.nDay)})),this.requestBody.jobConfDate=i.join(",");this.tt=i.join(","),this.showSelectTime=!1,this.inputCheck=4},onMediaSelect:function(e){var t={method:"selectMediaDataFromNative",parameters:{},callback:"receiveMediaDataFromNative"},i=6-this.fileList.length;0==e?t.method="takePhoto":1==e?(t.method="takeVideo",t.parameters={videoMaxTime:180}):2==e?(t.parameters={imageMaxCount:i},t.method="selectAlbum"):3==e&&(t.parameters={videoMaxTime:180},t.method="selectVideo"),p["a"].callNative(t)},onReUpload:function(e){var t={method:"reUploadMediaFromNative",parameters:{id:e.id,path:e.path},callback:"receiveMediaDataFromNative"};p["a"].callNative(t)},choiceCishu:function(e){this.cishu=e;var t=JSON.parse(JSON.stringify(e));t=t.map((function(e){var t={startTime:e.startTime,endTime:e.endTime};return t})),this.xuanzecishu=this.$t("polling.hasSelect"),this.requestBody.times=t,this.showChoiceTime=!1,this.inputCheck=5},onClickLeft:function(){var e=this;0==this.requestBody.groupUserIds.length&&(this.requestBody.groupUserIds=this.groupUserIds),JSON.stringify(this.requestBody)!=this.detailInfoData?this.$dialog.confirm({title:"",message:"您尚未保存信息，请确认是否返回",width:"270px",confirmButtonText:"返回",confirmButtonColor:"#48D4C6",cancelButtonText:"我再想想",cancelButtonColor:"#999999"}).then((function(){e.$router.go(-1)})):this.$router.go(-1)},clearAll:function(){this.requestBody={jobName:"",remark:""},this.showSelectTime=!1,this.selectDate=[],this.people=this.$t("polling.person"),this.showChoiceTime=!1,this.showPersonPop=!1,this.showSelectPerson=!1,this.showSelectPoint=!1,this.indexs=1,this.publishing=!1,this.jobType=0,this.checked=!1,this.inputCheck=1,this.isTeam=!1,this.Taskvalue="",this.picker="",this.unclick=!0,this.points="",this.tt="",this.xuanzecishu="",this.cishu=[],this.selectPersons=[[]],this.selectPoint=[],this.groupUserIds=[],this.actions=[{name:this.$t("polling.IndividualTasks")},{name:this.$t("polling.TeamTasks")}],this.fileList=[]},publish:function(){var e=this;if(0==this.requestBody.groupUserIds.length&&(this.requestBody.groupUserIds=this.groupUserIds),null!=this.requestBody.jobType&&""!=this.requestBody.jobName&&null!=this.requestBody.groupUserIds&&0!=this.requestBody.groupUserIds.length&&null!=this.requestBody.targets&&0!=this.requestBody.targets.length&&null!=this.requestBody.cycleType&&null!=this.requestBody.times&&0!=this.requestBody.times.length){this.requestBody.sortFlag=this.checked?1:0,this.requestBody.autoPlaceFlag=1,this.publishing=!0;var t=this.$refs.uploader.dataList.map((function(e){return{resourceId:e.id,resourceType:e.resourceType}})),i={id:this.$route.query.jobId,jobName:this.requestBody.jobName,groupUserIds:this.requestBody.groupUserIds,targets:this.requestBody.targets,cycleType:this.requestBody.cycleType,jobConfDate:this.requestBody.jobConfDate,times:this.requestBody.times,sortFlag:this.checked,autoPlaceFlag:this.requestBody.autoPlaceFlag,remark:this.requestBody.remark,resources:t,jobType:this.requestBody.jobType};return this.requestBody.inChargeGroupUserIds&&this.$set(i,"inChargeGroupUserIds",this.requestBody.inChargeGroupUserIds),void d["a"].editPeriodTask(i).then((function(t){e.$router.go(-1)}))}}},watch:{inputCheck:function(e){null==this.requestBody.jobType||""==this.requestBody.jobName||null==this.requestBody.groupUserIds||0==this.requestBody.groupUserIds.length||null==this.requestBody.targets||0==this.requestBody.targets.length||null==this.requestBody.cycleType||null==this.requestBody.times||0==this.requestBody.times.length?this.unclick=!0:this.unclick=!1}}},g=m,y=(i("975c"),i("c701")),v=Object(y["a"])(g,s,n,!1,null,"052e3faa",null);t["default"]=v.exports},"6e388":function(e,t,i){var s=i("2bc8");e.exports=!s((function(){return Object.isExtensible(Object.preventExtensions({}))}))},"975c":function(e,t,i){"use strict";i("2e1f")},b420:function(e,t,i){"use strict";var s=i("22af").f,n=i("b921"),o=i("8573"),r=i("1e51"),a=i("da02"),c=i("3afd"),l=i("cf0a"),u=i("6d96"),h=i("aba0"),d=i("b748").fastKey,p=i("891c"),f=p.set,m=p.getterFor;e.exports={getConstructor:function(e,t,i,l){var u=e((function(e,s){a(e,u,t),f(e,{type:t,index:n(null),first:void 0,last:void 0,size:0}),h||(e.size=0),void 0!=s&&c(s,e[l],{that:e,AS_ENTRIES:i})})),p=m(t),g=function(e,t,i){var s,n,o=p(e),r=y(e,t);return r?r.value=i:(o.last=r={index:n=d(t,!0),key:t,value:i,previous:s=o.last,next:void 0,removed:!1},o.first||(o.first=r),s&&(s.next=r),h?o.size++:e.size++,"F"!==n&&(o.index[n]=r)),e},y=function(e,t){var i,s=p(e),n=d(t);if("F"!==n)return s.index[n];for(i=s.first;i;i=i.next)if(i.key==t)return i};return o(u.prototype,{clear:function(){var e=this,t=p(e),i=t.index,s=t.first;while(s)s.removed=!0,s.previous&&(s.previous=s.previous.next=void 0),delete i[s.index],s=s.next;t.first=t.last=void 0,h?t.size=0:e.size=0},delete:function(e){var t=this,i=p(t),s=y(t,e);if(s){var n=s.next,o=s.previous;delete i.index[s.index],s.removed=!0,o&&(o.next=n),n&&(n.previous=o),i.first==s&&(i.first=n),i.last==s&&(i.last=o),h?i.size--:t.size--}return!!s},forEach:function(e){var t,i=p(this),s=r(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:i.first){s(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!y(this,e)}}),o(u.prototype,i?{get:function(e){var t=y(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),h&&s(u.prototype,"size",{get:function(){return p(this).size}}),u},setStrong:function(e,t,i){var s=t+" Iterator",n=m(t),o=m(s);l(e,t,(function(e,t){f(this,{type:s,target:e,state:n(e),kind:t,last:void 0})}),(function(){var e=o(this),t=e.kind,i=e.last;while(i&&i.removed)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?"keys"==t?{value:i.key,done:!1}:"values"==t?{value:i.value,done:!1}:{value:[i.key,i.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),i?"entries":"values",!i,!0),u(t)}}},b748:function(e,t,i){var s=i("0c09"),n=i("42cc"),o=i("b64f"),r=i("22af").f,a=i("95bd"),c=i("6e388"),l=a("meta"),u=0,h=Object.isExtensible||function(){return!0},d=function(e){r(e,l,{value:{objectID:"O"+ ++u,weakData:{}}})},p=function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,l)){if(!h(e))return"F";if(!t)return"E";d(e)}return e[l].objectID},f=function(e,t){if(!o(e,l)){if(!h(e))return!0;if(!t)return!1;d(e)}return e[l].weakData},m=function(e){return c&&g.REQUIRED&&h(e)&&!o(e,l)&&d(e),e},g=e.exports={REQUIRED:!1,fastKey:p,getWeakData:f,onFreeze:m};s[l]=!0},c301:function(e,t,i){"use strict";var s=i("a09b"),n=i("8d5c"),o=i("0ef8"),r=i("4450"),a=i("b748"),c=i("3afd"),l=i("da02"),u=i("42cc"),h=i("2bc8"),d=i("408b"),p=i("1a81"),f=i("6564");e.exports=function(e,t,i){var m=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),y=m?"set":"add",v=n[e],b=v&&v.prototype,T=v,k={},x=function(e){var t=b[e];r(b,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:function(e,i){return t.call(this,0===e?0:e,i),this})};if(o(e,"function"!=typeof v||!(g||b.forEach&&!h((function(){(new v).entries().next()})))))T=i.getConstructor(t,e,m,y),a.REQUIRED=!0;else if(o(e,!0)){var q=new T,w=q[y](g?{}:-0,1)!=q,B=h((function(){q.has(1)})),I=d((function(e){new v(e)})),P=!g&&h((function(){var e=new v,t=5;while(t--)e[y](t,t);return!e.has(-0)}));I||(T=t((function(t,i){l(t,T,e);var s=f(new v,t,T);return void 0!=i&&c(i,s[y],{that:s,AS_ENTRIES:m}),s})),T.prototype=b,b.constructor=T),(B||P)&&(x("delete"),x("has"),m&&x("get")),(P||w)&&x(y),g&&b.clear&&delete b.clear}return k[e]=T,s({global:!0,forced:T!=v},k),p(T,e),g||i.setStrong(T,e,m),T}}}]);