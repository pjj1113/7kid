(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0446999c"],{"2e09":function(t,e,a){"use strict";a("ae9b")},"45e5":function(t,e,a){},"58b2":function(t,e,a){"use strict";a("ab58")},"60b4":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit"},[a("nav-bar",{attrs:{onlyBack:!0},scopedSlots:t._u([{key:"title",fn:function(){return["teacher"==t.appData.appType?[a("div",{staticClass:"bar-title"},[t._v(t._s(t.clazzName))]),a("div",{staticClass:"bar-subtitle",on:{click:function(e){t.studentShow=!0}}},[1===t.page.scope?[t._v(t._s(t.$t("growth.groupPage")))]:[t._v(" "+t._s(t.$t("growth.personalPage"))+"-"+t._s(t.page.studentName)+" "),a("van-icon",{staticStyle:{"vertical-align":"-2px"},attrs:{name:"arrow-down",color:"#333",size:"10"}})]],2)]:[a("span",[t._v(t._s(t.page.title))])]]},proxy:!0},{key:"right",fn:function(){return[a("span",{directives:[{name:"show",rawName:"v-show",value:"teacher"==t.appData.appType&&2===t.page.scope,expression:"appData.appType =='teacher' && page.scope === 2"}],staticClass:"next-btn",on:{click:function(e){return t.nextStu()}}},[t._v(t._s(t.$t("growth.nextStudent")))])]},proxy:!0}])}),a("div",{staticClass:"wrap"},[a("div",{ref:"growthBlock",staticClass:"block",attrs:{id:"growthBlock"}},[a("div",{staticClass:"editor",style:{width:t.bWidth+"px",height:t.bHeight+"px"}},[a("div",{staticClass:"attach",on:{click:function(e){return t.$router.push({path:"display",query:{growthId:t.growthId,clazzThemeId:t.clazzThemeId,studentId:t.studentId,studentName:t.page.studentName}})}}},[t._v(t._s(t.$t("common.preview")))]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.currPage>1,expression:"currPage > 1"}],staticClass:"arrow left",on:{click:function(e){return t.setPage(-1)}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.currPage<t.maxPage,expression:"currPage < maxPage"}],staticClass:"arrow right",on:{click:function(e){return t.setPage(1)}}}),a("div",{staticClass:"edit-permission"},[t._v(t._s(1==t.page.writePermission?t.$t("growth.leaderEdit"):2==t.page.writePermission?t.$t("growth.teacherEdit"):t.$t("growth.parentEdit")))]),a("edit-panel",{attrs:{page:t.page,clazzId:t.clazzId,clazzName:t.clazzName,disabled:!t.ableEdit,scale:t.bWidth/595}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.pageNumber,expression:"pageNumber"}],staticClass:"page-number"},[a("span",[t._v(t._s(t.pageNumber))])])],1)]),a("div",{staticClass:"foot"},[a("div",{staticClass:"foot-block"},[a("div",{staticClass:"icon-block",on:{click:function(e){t.catalogueShow=!0}}},[a("van-icon",{attrs:{name:"bars",size:"20"}}),a("div",[t._v(t._s(t.$t("growth.catalogue")))])],1),a("div",{staticClass:"slide-block"},[a("van-slider",{attrs:{"bar-height":"4px","active-color":"#A0A3B4",min:1,max:t.maxPage},on:{change:t.changeCata},scopedSlots:t._u([{key:"button",fn:function(){return[a("div",{staticClass:"slide-button"})]},proxy:!0}]),model:{value:t.currPage,callback:function(e){t.currPage=e},expression:"currPage"}})],1),a("div",{staticClass:"page-block"},[a("div",{staticClass:"page-indicator"},[t._v(t._s(t.totalPage))])])])])]),a("van-popup",{style:{width:"88%",height:"100%"},attrs:{position:"left"},model:{value:t.catalogueShow,callback:function(e){t.catalogueShow=e},expression:"catalogueShow"}},[a("div",{staticClass:"catalogue"},[a("div",{staticClass:"info"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("growth.catalogue")))]),"teacher"==t.appData.appType?a("div",{staticClass:"desc"},[t._v(t._s(t.$t("growth.growthAttachment")))]):t._e(),"teacher"==t.appData.appType?a("div",{staticClass:"page"},[t._v(t._s(t.growthAttachment1))]):t._e()]),a("div",{staticClass:"cataList"},[a("van-cell-group",t._l(t.catalogueList,(function(e,i){return a("van-cell",{key:i,class:[{active:e.pagination==t.currPage},0!=e.pid?"child":"parent"],on:{click:function(a){return t.clickCata(e)}}},[a("template",{slot:"title"},[a("div",[0!=e.pid?a("span",{staticClass:"dot"}):t._e(),t._v(" "+t._s(e.title)+" ")])]),a("template",{slot:"default"},["teacher"==t.appData.appType?[e.isDone?a("div",[t._v(t._s(t.$t("growth.finished")))]):2===e.scope?a("div",{staticClass:"unfinish"},[t._v(t._s(t.$t("growth.unfinished"))+"("+t._s(e.studentDone+"/"+e.studentTotal)+")")]):a("div",{staticClass:"unfinish"},[t._v(t._s(t.$t("growth.unfinished")))])]:3===e.writePermission?[e.isDone?a("div",[t._v(t._s(t.$t("growth.finished")))]):a("div",{staticClass:"unfinish"},[t._v(t._s(t.$t("growth.unfinished")))])]:t._e()],2)],2)})),1)],1)])]),a("van-popup",{style:{width:"100%",height:"100%"},attrs:{position:"top"},model:{value:t.studentShow,callback:function(e){t.studentShow=e},expression:"studentShow"}},[a("van-nav-bar",{attrs:{fixed:""},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.page.title)+"（"+t._s(t.studentDone)+"/"+t._s(t.studentTotal)+"）")]},proxy:!0},{key:"left",fn:function(){return[a("van-icon",{attrs:{name:"arrow-left",color:"#333",size:"20"},on:{click:function(e){t.studentShow=!1}}})]},proxy:!0}])}),a("div",{staticClass:"studentList"},[a("van-cell-group",{attrs:{title:t.$t("growth.pageAttachment")}},t._l(t.studentList,(function(e,i){return a("van-cell",{key:i,class:{active:e.studentId==t.studentId},attrs:{title:e.studentName,value:e.studentId,"is-link":"",clickable:""},on:{click:function(a){return t.changeStu(e.studentId)}}},[a("template",{slot:"right-icon"},[a("van-icon",{class:{unfinish:!e.isDone,"van-cell__right-icon":!0},attrs:{name:"arrow"}})],1),a("template",{slot:"default"},[e.isDone?a("div",[t._v(t._s(t.$t("growth.pageFinished")))]):a("div",{staticClass:"unfinish"},[t._v(t._s(t.$t("growth.pageUnfinished")))])])],2)})),1)],1)],1)],1)},n=[],s=(a("445a"),a("cb3c"),a("13cf"),a("a543"),a("6540"),a("b131"),a("1d7a"),a("0bd5"),a("9b42"),a("6a61"),a("2e91")),o=a("4c09"),c=a("2939"),r=a("c98f"),l=a("da1d"),u=a("a8e1"),d=a("b132d"),h=a("86bd"),p={name:"growth-growth-edit",components:{navBar:l["a"],editPanel:d["a"]},mixins:[u["a"]],data:function(){return{clazzThemeId:this.$route.query.clazzThemeId,studentId:this.$route.query.studentId,growthId:this.$route.query.growthId,clazzName:"",clazzId:"",currPage:1,maxPage:1,catalogueShow:!1,catalogueList:[],catalogueSorts:[],studentShow:!1,studentDone:"*",studentTotal:"*",page:{title:this.$t("growth.growth")},appData:{appType:""}}},computed:{ableEdit:function(){return"teacher"===this.appData.appType&&2===this.page.writePermission||"parent"===this.appData.appType&&3===this.page.writePermission},studentList:function(){var t=this,e=this.catalogueList.find((function(e){return e.pagination==t.currPage}));return this.studentDone=e?e.studentDone:"*",this.studentTotal=e?e.studentTotal:"*",e&&e.clazzThemePageStudentsStat?e.clazzThemePageStudentsStat:[]},growthAttachment1:function(){var t=this.$t("growth.growthAttachment1").replace(/\{\{[^\}]+\}\}/,this.maxPage);return t=t.replace(/\{\{[^\}]+\}\}/,this.catalogueList.filter((function(t){return t.isDone})).length),t},totalPage:function(){return this.$t("growth.totalPage").replace(/\{\{[^\}]+\}\}/,this.maxPage)},pageNumber:function(){var t=Math.max.apply(Math,Object(o["a"])(this.catalogueSorts.concat([0]))),e=this.catalogueList.slice(0,-1).filter((function(e){return e.sort>t})).map((function(t){return t.pagination}));return e.indexOf(this.currPage)+1}},created:function(){this.appData=c["a"].getAppData()},mounted:function(){this.getStuGrowthByPage()},beforeRouteEnter:function(t,e,a){t.meta.keepAlive||(t.meta.keepAlive=!0,t=Object.assign({},t)),a()},beforeRouteLeave:function(t,e,a){"growth-growth-display"!=t.name&&(e.meta.keepAlive=!1,e=Object.assign({},e)),a()},methods:{getGrowthPageProcess:function(){var t=this;Object(r["i"])({clazzThemeId:this.clazzThemeId}).then((function(e){t.clazzName=e.data.clazzName,t.clazzId=e.data.clazzId,t.catalogueList=e.data.clazzThemePagesStat,t.maxPage=t.catalogueList.length,t.catalogueSorts=e.data.contentsPageSorts}))},getGrowthCatalogs:function(){var t=this;Object(r["g"])({growthId:this.growthId}).then((function(e){t.catalogueList=e.data,t.maxPage=t.catalogueList.length,t.catalogueSorts=t.catalogueList[0].contentsPageSorts||[]}))},getStuGrowthByPage:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.page.id){e.next=3;break}return e.next=3,t.saveLastPage();case 3:"teacher"==t.appData.appType?(!t.ableEdit&&t.page.id||t.getGrowthPageProcess(),Object(r["l"])({clazzThemeId:t.clazzThemeId,studentId:t.studentId,pagination:t.currPage}).then((function(e){t.page=Object(h["a"])(e.data)}))):(!t.ableEdit&&t.page.id||t.getGrowthCatalogs(),Object(r["b"])({growthId:t.growthId,pagination:t.currPage}).then((function(e){t.page=Object(h["a"])(e.data)})));case 4:case"end":return e.stop()}}),e)})))()},changeCata:function(t){this.getStuGrowthByPage()},clickCata:function(t){t.pagination!=this.currPage&&(this.currPage=t.pagination,this.catalogueShow=!1,this.getStuGrowthByPage())},setPage:function(t){this.currPage+t>0&&this.currPage+t<=this.maxPage&&(this.currPage+=t,this.getStuGrowthByPage())},changeStu:function(t){this.studentId=t,this.studentShow=!1,this.getStuGrowthByPage()},nextStu:function(){var t=this,e=this,a=this.studentList.filter((function(e){return!e.isDone||e.studentId==t.studentId})).map((function(t){return t.studentId})),i=a.indexOf(e.studentId),n=(i+1)%a.length;if(a.length>1)this.studentId=a[n];else if(1==a.length){var s=this.studentList.map((function(t){return t.studentId})),o=s.indexOf(e.studentId);this.studentId=s[(o+1)%s.length]}this.getStuGrowthByPage()},saveLastPage:function(){var t=this;if(this.ableEdit&&this.page.pagesDetail&&this.page.pagesDetail.length>0){var e=this.page.pagesDetail.map((function(e){if(5===t.page.pageType){var a=t.page.contentLayout.find((function(t){return"kid-appraise"===t.elName})).propsValue.realData.find((function(t){return t.sort==e.sort})).evaluation||"";return{id:e.id,content:a}}var i=t.page.contentLayout.find((function(t){return t.sort==e.sort}));return{id:e.id,content:i.propsValue.realData}}));"teacher"===this.appData.appType?Object(r["o"])({id:this.page.id,pagesDetail:e}):Object(r["n"])({id:this.page.id,pagesDetail:e}).catch((function(e){var a=e.response.data||{},i=a.code,n=void 0===i?"":i;"growth-3014"===n&&(t.page={title:t.$t("growth.growth")},t.currPage=1,t.getStuGrowthByPage())}))}}}},g=p,m=(a("58b2"),a("c701")),f=Object(m["a"])(g,i,n,!1,null,"5a300d09",null);e["default"]=f.exports},"796a":function(t,e,a){"use strict";a("45e5")},a7d6:function(t,e,a){"use strict";a("f257")},ab58:function(t,e,a){},ae9b:function(t,e,a){},b132d:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit-panel"},[a("div",{staticClass:"container",style:{transform:"scale("+t.scale+")"}},[a("div",{staticClass:"page",style:{width:"100%",height:"100%",backgroundSize:"cover",backgroundImage:"url("+t.page.backgroundUrl+")"},on:{click:function(e){if(e.target!==e.currentTarget)return null;t.editIndex=-1}}},[t._l(t.page.contentLayout,(function(e,i){return[a("operator",{attrs:{element:e,elementIndex:i,display:t.display,disabled:t.disabled,editIndex:t.editIndex,writePermission:t.page.writePermission},on:{"update:editIndex":function(e){t.editIndex=e},"update:edit-index":function(e){t.editIndex=e},click:function(t){t.stopPropagation()},save:t.save}})]}))],2)]),t.editIndex>-1?a("van-popup",{staticClass:"textEditor",attrs:{position:"bottom"},model:{value:t.textChangeShow,callback:function(e){t.textChangeShow=e},expression:"textChangeShow"}},[a("text-editor",{attrs:{content:t.editEle.propsValue.realData,show:t.textChangeShow},on:{"update:content":function(e){return t.$set(t.editEle.propsValue,"realData",e)},"update:show":function(e){t.textChangeShow=e},save:t.save}})],1):t._e(),t.editIndex>-1?a("van-action-sheet",{attrs:{actions:t.filterActions,"cancel-text":t.$t("common.cancel"),"close-on-click-action":""},on:{select:t.mediaSelect},model:{value:t.imgChangeShow,callback:function(e){t.imgChangeShow=e},expression:"imgChangeShow"}}):t._e()],1)},n=[],s=(a("cb3c"),a("c726"),a("0bd5"),a("b784"),a("79a8"),a("ebc2")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"text-editor"},[a("van-row",{attrs:{type:"flex",justify:"space-between"}},[a("van-col",{attrs:{span:"4"},on:{click:function(e){return t.close()}}},[t._v(t._s(t.$t("common.cancel")))]),a("van-col",{staticStyle:{"text-align":"right"},attrs:{span:"4"},on:{click:function(e){return t.save()}}},[t._v(t._s(t.$t("common.save")))])],1),a("van-field",{ref:"textInput",staticClass:"text-area",attrs:{rows:"10",maxlength:"800",autosize:"",autofocus:"",type:"textarea",placeholder:t.$t("growth.inputPlaceholder")},model:{value:t.cont,callback:function(e){t.cont=e},expression:"cont"}})],1)},c=[],r={name:"textEditor",props:["content","show"],data:function(){return{cont:this.content}},computed:{},watch:{content:function(t,e){this.cont=t}},mounted:function(){},methods:{close:function(){this.$emit("update:show",!1)},save:function(){this.$emit("update:content",this.cont),this.$emit("save",!0),this.close()}}},l=r,u=(a("796a"),a("c701")),d=Object(u["a"])(l,o,c,!1,null,"73da52c6",null),h=d.exports,p=(a("2939"),{name:"EditPanel",props:["page","clazzId","scale","disabled","display","clazzName"],components:{operator:s["a"],textEditor:h},data:function(){return{editIndex:-1,editEle:{},textChangeShow:!1,imgChangeShow:!1,actions:[{name:this.$t("growth.selectAiAlbum"),method:"selectAiAlbum",crop:!0,type:"media"},{name:this.$t("growth.localAlbum"),method:"selectAlbum",crop:!0,type:"image"},{name:this.$t("growth.localVideo"),method:"selectVideo",type:"video"},{name:this.$t("growth.takePhoto"),method:"takePhoto",crop:!0,type:"image"},{name:this.$t("growth.takeVideo"),method:"takeVideo",type:"video"}],imgTypes:["bmp","jpg","jpeg","png","tif","gif","exif","webp"],videoTypes:["mp4","avi","mov","rmvb","rm","flv","3gp","mpeg","ogg"]}},computed:{filterActions:function(){return"kid-video"==this.editEle.elName?this.actions.filter((function(t){return"video"==t.type||"media"==t.type})):"kid-image-only"==this.editEle.elName?this.actions.filter((function(t){return"image"==t.type||"media"==t.type})):this.actions}},watch:{page:function(t,e){this.editIndex=-1},editIndex:function(t,e){t!==e&&t>-1?(this.editEle=this.page.contentLayout[t],this.textChangeShow=!!["kid-text","kid-title"].includes(this.editEle.elName),this.imgChangeShow=!!["kid-image","kid-video","kid-image-only"].includes(this.editEle.elName)):this.editEle={}}},mounted:function(){var t=this;window.sendMediaData=function(e){return t.getMediaData(e)}},methods:{mediaSelect:function(t,e){var a={method:t.method,callback:"sendMediaData",parameters:{clazzId:this.clazzId,clazzName:this.clazzName,studentId:1===this.page.scope?"":this.page.studentId,crop:t.crop||void 0,width:this.editEle.commonStyle.width,height:this.editEle.commonStyle.height}};callNative(a)},getMediaData:function(t){var e=t.parameters.data[0].upDataAliResponse,a=e.url.split(".").pop().toLowerCase();if("kid-image-only"!=this.editEle.elName||this.imgTypes.includes(a)){if("kid-video"!=this.editEle.elName||this.videoTypes.includes(a))return this.$set(this.editEle,"propsValue",{imageSrc:e.url,realData:e.url}),this.save(),this.imgChangeShow=!1,!0;this.$toast(this.$t("growth.fillTypeWarning"))}else this.$toast(this.$t("growth.fillTypeWarning"))},save:function(t){this.$parent.saveLastPage()}}}),g=p,m=(a("2e09"),Object(u["a"])(g,i,n,!1,null,"37463efe",null));e["a"]=m.exports},da1d:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("van-nav-bar",{attrs:{title:t.t_title,fixed:"",border:t.border}},[t._t("left",[a("van-icon",{staticClass:"nav-go",attrs:{name:"arrow-left"},on:{click:t.onClickLeft}})],{slot:"left"}),t._t("title",null,{slot:"title"}),t._t("right",null,{slot:"right"})],2)},n=[],s=a("2939"),o={computed:{t_title:function(){return this.title?this.title:/.*[\u4e00-\u9fa5]+.*$/.test(this.$route.meta.title)?this.$route.meta.title:this.$t("route.".concat(this.$route.meta.title))}},props:{border:{type:Boolean,default:!0},onlyBack:{type:Boolean,default:!1},title:{type:String}},methods:{onClickLeft:function(){this.onlyBack||s["a"].closeWebview(),this.$router.go(-1)}}},c=o,r=(a("a7d6"),a("c701")),l=Object(r["a"])(c,i,n,!1,null,"2f4d49ad",null);e["a"]=l.exports},f257:function(t,e,a){}}]);