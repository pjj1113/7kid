(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cf84f4c6"],{"0224":function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"visitant-manage",style:{paddingTop:t.active?"0":"46px"}},[t.active?t._e():a("nav-bar"),a("div",{class:{top:!t.active}},[a("div",{staticClass:"searchBar"},[a("form",{attrs:{action:"/"}},[a("van-search",{class:[{search:t.active},{unSearch:!t.active}],attrs:{shape:"round",background:"#ffffff","input-align":t.inputAlign,placeholder:"搜索","action-text":"取消","show-action":t.showAction},on:{search:t.onSearch,cancel:t.onCancel,input:t.onInput,focus:t.onFocus},model:{value:t.searchKey,callback:function(i){t.searchKey=i},expression:"searchKey"}})],1)]),a("router-link",{directives:[{name:"permission",rawName:"v-permission",value:["school-visitor-manage-application-record"],expression:"['school-visitor-manage-application-record']"}],attrs:{to:"/visitant/check"}},[t.active?t._e():a("div",{staticClass:"check-wrap"},[a("div",{staticClass:"check-info"},[a("img",{staticClass:"check-img",attrs:{src:e("9d95"),alt:""}}),a("span",{staticClass:"check-text"},[t._v("预约审核")])]),a("div",{staticClass:"check-right"},[a("div",{staticClass:"check-tag"},[t._v(t._s(t.noCheckNum<=99?t.noCheckNum:"99"))]),a("van-icon",{attrs:{name:"arrow",color:"#666",size:"16px"}})],1)])])],1),a("div",{staticClass:"main",class:{hidd:t.active}},[a("div",{staticClass:"title"},[t._v("访客记录")]),a("van-tabs",{attrs:{background:"#ffffff","title-inactive-color":"#999999","title-active-color":"#48D4C6",sticky:"","offset-top":46},on:{click:t.tabClick}},t._l(t.tabs,(function(i){return a("van-tab",{key:i.id,attrs:{title:i.text+" "+(i.num<=99?i.num:99)}},[a("div",{staticClass:"tab-content"},[t.visitantList.length?a("div",{staticClass:"visitant-list"},[a("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(i){t.refreshing=i},expression:"refreshing"}},[a("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1,offset:t.offset},on:{load:t.onLoad},model:{value:t.loading,callback:function(i){t.loading=i},expression:"loading"}},t._l(t.visitantList,(function(i){return a("div",{key:i.id,staticClass:"visitant-item",on:{click:function(e){return t.centerPage(i.id)}}},[a("div",{staticClass:"visitant-top"},[a("div",{staticClass:"name-status"},[a("div",{staticClass:"visitant-name"},[t._v(t._s(i.visitorName))]),a("div",{staticClass:"visitant-status",style:{color:t.color[i.status]}},[t._v(t._s(t.statusText(i.status)))])]),a("div",{staticClass:"time-name"},[a("div",{staticClass:"time"},[a("span",{staticClass:"text"},[t._v(t._s(3!==i.status?"预约时间：":"入离园时间："))]),t._v(t._s(t.formatDate(3!==i.status?i.beginTime:i.entryTime))+"~"+t._s(t.formatDate(3!==i.status?i.endTime:i.outTime)))]),a("div",{staticClass:"receptionName"},[a("span",{staticClass:"text"},[t._v("接待人：")]),t._v(t._s(i.receptionName))])])]),0==i.status||1==i.status||2==i.status?a("div",{directives:[{name:"permission",rawName:"v-permission",value:["school-visitor-manage-visitor-record-update"],expression:"['school-visitor-manage-visitor-record-update']"}],staticClass:"visitant-bottom"},[0==i.status?a("van-button",{attrs:{round:"",plain:"",size:"large",color:"#27CBBB",type:"info"},on:{click:function(e){return e.stopPropagation(),t.addAccessRecord(i.status,i.id)}}},[t._v("访客入园")]):t._e(),1==i.status?a("van-button",{attrs:{round:"",plain:"",size:"large",color:"#27CBBB",type:"info"},on:{click:function(e){return e.stopPropagation(),t.addAccessRecord(i.status,i.id)}}},[t._v("访客离园")]):t._e(),2==i.status?a("van-row",{attrs:{justify:"center"}},[a("van-col",{attrs:{span:"11"}},[a("van-button",{attrs:{size:"large",round:"",plain:"",hairline:"",block:"",color:"#27CBBB",type:"info"},on:{click:function(e){return e.stopPropagation(),t.delayDateShow(i.id)}}},[t._v("延长时间")])],1),a("van-col",{attrs:{span:"2"}}),a("van-col",{attrs:{span:"11"}},[a("van-button",{attrs:{size:"large",round:"",plain:"",hairline:"",block:"",color:"#27CBBB",type:"info"},on:{click:function(e){return e.stopPropagation(),t.addAccessRecord(i.status,i.id)}}},[t._v("访客离园")])],1)],1):t._e()],1):t._e()])})),0)],1)],1):a("empty-block",{attrs:{description:"幼儿园尚无访客记录"}})],1)])})),1),a("van-dialog",{attrs:{confirmButtonColor:"#48D4C6",confirmButtonText:"提交","show-cancel-button":""},on:{confirm:t.delayDate},model:{value:t.delayDateBox,callback:function(i){t.delayDateBox=i},expression:"delayDateBox"}},[a("div",{staticClass:"delay-date-box"},[a("h3",[t._v("确认延长结束时间")]),a("p",{staticClass:"date-box-title"},[t._v("延时后，访客将被允许继续留园")]),a("div",{staticClass:"date-box-info"},[a("p",[t._v("请选择时长：")]),a("div",t._l(t.delayDateArr,(function(i,e){return a("span",{key:e,class:t.duration==i&&"active",on:{click:function(e){return t.updateDelayDate(i)}}},[t._v(t._s(i%60?i%60+"分钟":i/60+"小时"))])})),0)])])]),a("img",{directives:[{name:"permission",rawName:"v-permission",value:["school-visitor-manage-visitor-record-update"],expression:"['school-visitor-manage-visitor-record-update']"}],staticClass:"sao-img",attrs:{src:e("d999"),alt:""},on:{click:t.clickCode}})],1)],1)},n=[],s=(e("445a"),e("a543"),e("d0bf"),e("402f"),e("0bd5"),e("79a8"),e("7336"),e("b08c")),o=(e("3f27"),e("8048")),r=e("da1d"),c=e("8abc"),u=e("2939"),l=e("1619"),d=e("02aa"),v={data:function(){return{inputAlign:"center",tabs:[{id:1,text:"全部"},{id:2,text:"未入园"},{id:3,text:"已入园"},{id:4,text:"已超时"}],userInfo:"",orgId:"",isSend:!1,visitantList:[],pageSize:20,pageNum:1,formatDate:"",activeTab:"全部",status:"",delayDateBox:!1,delayDateArr:[60,120,240],duration:30,visitantid:"",active:!1,searchKey:"",showAction:!1,loading:!1,finished:!1,refreshing:!1,offset:100,title:"",noCheckNum:0,currentName:"",currentTitle:"",color:["#4DA8E5","#4DA8E5","#F16262","#999999","#999999"],requesting:!1}},components:{EmptyBlock:d["a"],navBar:r["a"]},computed:{activeStatus:function(){this.activeTab=this.title.split(" ")[0];var t="";return"未入园"===this.activeTab?t=0:"已入园"===this.activeTab?t=1:"已超时"===this.activeTab&&(t=2),t}},mounted:function(){var t=this;window.receiveQrcodeScanResult=function(i){return t.verifyQrCode(i)},this.formatDate=l["formatDate"],u["a"].getAppData(),this.userInfo=localStorage.getItem("jsBridgeInfo")&&JSON.parse(localStorage.getItem("jsBridgeInfo"))||"",this.userInfo.token?this.orgId=this.userInfo.orgId:(this.$route.query.orgId&&(this.orgId=this.$route.query.orgId),this.$route.query.schoolId&&(this.orgId=this.$route.query.schoolId)),this.getVisitantList(this.pageSize,1),c["a"].getNoCheckNum().then((function(i){t.noCheckNum=i.data[0].unReadCount})),o["a"].setDefaultOptions({confirmButtonColor:"#48D4C6",cancelButtonColor:"#333333"})},methods:{centerPage:function(t){this.$router.push({name:"visitant-record",query:{id:t}})},verifyQrCode:function(t){var i=this,e=t.parameters.content.data,a=e.id,n=e.timestamp;c["a"].verifyQrCode({id:a,timestamp:n}).then((function(t){[0,1,2,3].indexOf(Number(t.data.status))>-1?i.$router.push({name:"visitant-verify",query:{id:t.data.id}}):Object(s["a"])("通行证已失效，请访客重新申请！")})).catch((function(t){}))},getVisitantList:function(t,i){var e=this;""===this.activeStatus?this.searchKey?c["a"].getVisitantList({name:this.searchKey,pageSize:t,pageNum:i}).then((function(t){e.refreshing&&(e.refreshing=!1);var i=t.data,a=i.total,n=i.notInNum,s=i.hasInNum,o=i.overTimeNum;if(e.addTabNum(a,n,s,o),null==t.data.list||0===t.data.list.length)return e.finished=!0,void(e.loading=!1);e.visitantList=e.visitantList.concat(t.data.list),e.loading=!1,e.visitantList&&e.visitantList.length>=t.data.total&&(e.finished=!0)})):c["a"].getVisitantList({pageSize:t,pageNum:i}).then((function(t){e.refreshing&&(e.refreshing=!1);var i=t.data,a=i.total,n=i.notInNum,s=i.hasInNum,o=i.overTimeNum;if(e.addTabNum(a,n,s,o),null==t.data.list||0===t.data.list.length)return e.finished=!0,void(e.loading=!1);e.visitantList=e.visitantList.concat(t.data.list),e.loading=!1,e.visitantList&&e.visitantList.length>=t.data.total&&(e.finished=!0)})):c["a"].getVisitantList({status:this.activeStatus,pageSize:t,pageNum:i}).then((function(t){e.refreshing&&(e.refreshing=!1);var i=t.data,a=i.total,n=i.notInNum,s=i.hasInNum,o=i.overTimeNum;if(e.addTabNum(a,n,s,o),null==t.data.list||0===t.data.list.length)return e.finished=!0,void(e.loading=!1);e.visitantList=e.visitantList.concat(t.data.list),e.loading=!1,e.visitantList&&e.visitantList.length>=t.data.total&&(e.finished=!0)}))},tabClick:function(t,i){this.title=i,this.clearPull()},statusText:function(t){var i="";return 0===t?i="未入园":1===t?i="已入园":2===t?i="已超时":3===t?i="已结束":4===t&&(i="已失效"),i},clearPull:function(){this.finished=!1,this.visitantList=[],this.pageNum=1,this.getVisitantList(this.pageSize,1)},addAccessRecord:function(t,i){var e=this;o["a"].confirm({title:"".concat(t?"确认访客离园？":"确认访客入园？"),message:"".concat(t?"访客离园后，本次拜访将 结束！":"同意入园后，访客记录状态将更新为已入园！")}).then((function(){c["a"].addAccessRecord({id:i}).then((function(t){e.clearPull(),u["a"].visitorsRefreshStatus(),Object(s["a"])("操作成功")}))})).catch((function(){}))},clickCode:function(){var t={method:"qrCodeScanFromNative",parameters:{},callback:"receiveQrcodeScanResult"};u["a"].callNative(t)},delayDateShow:function(t){this.delayDateBox=!0,this.visitantid=t},updateDelayDate:function(t){this.duration=t},delayDate:function(){var t=this;this.requesting||(this.requesting=!0,c["a"].delayDate({id:this.visitantid,duration:this.duration}).then((function(i){t.clearPull(),Object(s["a"])("操作成功")})).finally((function(){setTimeout((function(){t.requesting=!1}),800)})))},onCancel:function(){this.showAction=!1,this.active=!1,this.inputAlign="center",this.title=this.currentTitle,this.clearPull()},onFocus:function(){this.searchKey="",this.active=!0,this.inputAlign="left",this.showAction=!0,this.currentTitle=this.title,this.title="全部 ",this.clearPull()},onInput:function(){},addTabNum:function(t,i,e,a){this.$set(this.tabs[0],"num",t),this.$set(this.tabs[1],"num",i),this.$set(this.tabs[2],"num",e),this.$set(this.tabs[3],"num",a)},onSearch:function(){var t=this;this.currentName=this.searchKey,c["a"].getVisitantList({name:this.searchKey,pageSize:this.pageSize,pageNum:1}).then((function(i){var e=i.data,a=e.total,n=e.notInNum,s=e.hasInNum,o=e.overTimeNum;t.addTabNum(a,n,s,o),t.visitantList=i.data.list}))},onRefresh:function(){this.clearPull()},onLoad:function(){this.getVisitantList(this.pageSize,++this.pageNum)}}},f=v,h=(e("ea0c"),e("c701")),p=Object(h["a"])(f,a,n,!1,null,"6ef0b640",null);i["default"]=p.exports},"02aa":function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"empty-block"},[e("img",{style:{width:"225px"},attrs:{src:t.image}}),t._t("description",[e("div",{staticClass:"description"},[t._v(t._s(t.description))])])],2)},n=[],s={name:"empty-block",props:{image:{type:String,default:e("54e3")},description:{type:String,default:"暂无数据"}},data:function(){return{}}},o=s,r=(e("4015"),e("c701")),c=Object(r["a"])(o,a,n,!1,null,"77b72184",null);i["a"]=c.exports},4015:function(t,i,e){"use strict";e("d11b")},"54e3":function(t,i,e){t.exports=e.p+"img/icon_empty_page.a17e32dd.png"},"75f0":function(t,i,e){},"8abc":function(t,i,e){"use strict";var a,n=e("28f8"),s=e("d722");i["a"]=(a={uploadFile:function(t){return Object(s["b"])("/file/v1/file/upload/binary",t,{headers:{"Content-Type":"multipart/form-data"}})},addVisitant:function(t,i){return Object(s["b"])("/visitor/v1/applicationRecord/applicationAdd",t,{headers:{"Content-Type":"application/json"}},i)},addVisitantTeacher:function(t,i){return Object(s["b"])("/visitor/v1/applicationRecord/TeacherAdd",t,{headers:{"Content-Type":"application/json"}},i)},applicationDetails:function(t){return Object(s["b"])("/visitor/v1/applicationRecord/getById",t)},applicationAgree:function(t){return Object(s["b"])("/visitor/v1/applicationRecord/agree",t)},applicationRefuse:function(t){return Object(s["b"])("/visitor/v1/applicationRecord/refuse",t)},sendSmsCode:function(t){return Object(s["b"])("/message/v1/sms/send-sms-code",t)},verifySmsCodSe:function(t){return Object(s["b"])("/message/v1/sms/verify-sms-code",t)},getSchoolInfo:function(t){return Object(s["b"])("/visitor/v1/applicationRecord/getSchoolInfo",t)},getVisitorTeacherInfo:function(t){return Object(s["b"])("/visitor/v1/applicationRecord/getTeacherInfo",t)},teacherLogin:function(t){return Object(s["b"])("/iam/v1/web-oauth/kid-login/teacher-login",t)},getVisitantDetail:function(t){return Object(s["b"])("/visitor/v1/visitor/record/get-by-id",t)}},Object(n["a"])(a,"applicationRefuse",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/refuse",t)})),Object(n["a"])(a,"applicationAgree",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/agree",t)})),Object(n["a"])(a,"delayDate",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/delay-time",t)})),Object(n["a"])(a,"addAccessRecord",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/add-access-record",t)})),Object(n["a"])(a,"visitantGoSchool",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/entry-school",t)})),Object(n["a"])(a,"visitantOutSchool",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/out-school",t)})),Object(n["a"])(a,"qrCodeInfo",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/get-qr-code-info",t)})),Object(n["a"])(a,"verifyQrCode",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/verify-qr-code-info",t)})),Object(n["a"])(a,"cardType",(function(t){return Object(s["b"])("/visitor/v1/option/cardType",t)})),Object(n["a"])(a,"wechatShare",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/get-wechat-share-info",t)})),Object(n["a"])(a,"smsInvite",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/sms-invite",t)})),Object(n["a"])(a,"applicationList",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/applicationList",t)})),Object(n["a"])(a,"getVisitantList",(function(t){return Object(s["b"])("/visitor/v1/visitor/record/query-list",t,{headers:{"Content-Type":"application/json"}})})),Object(n["a"])(a,"getCheckList",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/applicationList",t)})),Object(n["a"])(a,"getNoCheckNum",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[30];return Object(s["b"])("/visitor/v1/teacher/msg/unread",t,{headers:{"Content-Type":"application/json"}})})),Object(n["a"])(a,"getYesCheckList",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/yesApprovalList",t)})),Object(n["a"])(a,"getNoCheckList",(function(t){return Object(s["b"])("/visitor/v1/applicationRecord/noApprovalList",t)})),Object(n["a"])(a,"getCodeConfing",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s["b"])("/visitor/v1/application/backgroundConfig",t)})),a)},"9d95":function(t,i){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAiCAYAAADcbsCGAAAEx0lEQVRYR7WYW2wUZRTHf2emV8q13MqdQCVKFLyQKLfEWE0UEk2wrdX4QJiKRlGURDSA2IYYTTRoIKLRLYk+oHQLBBXFaHzQYIwaEQ1pgrcoolIh0FoLbXfmmG/azl4ouzNLPU87s+d/zu+7ne/sChFMW1ZeBvZqhVtRZvhS4VeBgySs16Xu9WMRwuV0lZwegDY0WFz1+xZ19XGEwotoegVe4Oi0TdLQ4IWJm8snJ5wqwh7nLVXuyhXMn0iRZu6M1YmgYfyz+eSGiztPKDwXJZHCBrum6dkomsF8s8Lp3gcmqNv7EzA8YqJO6ZVKuSd2MqIuzT07XIuzVpWX8kkgwjqpbnoxH+2AJiucF3feA5bnlUB536ptyk/bnzD7zMWdIwrz8oET5HupieWlDTVzGneOKszNC05oleqmvLRh4T7wC24eJiIfSnUsL204uJb6J1U1r5IwFOUk+57bv2qy9ogpJSVRJk/gPNpbKbVvnoiiy/TNXYRbnEZVNkdJIugWqdkZSRO5CBuBNtfYKiP3hy0pAgfQjjukNu5GGVBecP2ARZ6M2CrwoLk9B0+q5hp+xdKOx6Q23pPpo6rlwG3AbGAccBr4ETgoIubzBZZzWVMVuu++qzXhfQEUp74XkW7QhVLddHgQqFnAM0A1UDAIQwLYC2wQ8fd3YJHg/FlscTpUGZEeRDqlJpb2zvdVrQN2AqUhlvg84IjIrlClZLCAYeFUdRUQ89vR8GbarNUiYnSRhH6KMHCqeh1wKHP5tec4XtcRcM+CPQpr2HykaHomutmvS0Xky2BUfrc7/6/pdCeyL4GtXymUZUTsElcWBO9qX40h9qKBZ/V68E6/gf77OVK2GCm9Au/sO5BoQ8oWYo1diVhFqSEPicgSH06bneUIOxQuGEb4Fen3LJ+F3LQhkJkz7LZth3N9Z8We1IgUT8c9vQv956M+v9L52BPWmi46Nd0S0bfrb1BbP7vISYrMxpUrkMuXBTqv6zBe27bg2Z7c6C9lGhxgjV+DVWZ2Q2DPizY7B1RIRouOk65Yug6ZmGxG3LaX0a6vc8JJ6bXYEx9OjfWJaNxpVxh5qUyB/pZGZNSU4DFxYiP0/pETjoIKCqam9Rit4sWdS/6VlDawmzcjo5NbN3FiM/QeT8JNehqKZuC1v4ue3ZeUFk6lYMqW1FDfDT3c4keQSckG2D21E+00W7rPrPJ7sUZWoeritu2Ac9/4780ptsfXp8IdNMtqficMnV1z9zRmVwV02v0z7p8pM2INw5q4Hqt4BqoJ3JNb4XwrdsUmpMRcu4FtjFK9Qw1AVecArWaSBgTumT1oe8ocWMOxKtYjhVPxzjT7rnZ5TWp8s9XmJovw7vplWDozFEEupxvXr2XcHAMZmNfxMZ7ZY15X//oOR8quRworkBFVmTVut4jUBXBe3DE92+258ob6vnQMVD2FlKQXAXNTaPcxcNv960uK52TeDCb838ACEfktgHPjTpOAuayHxsZWwtJHkYJIHX6naWpF5FP/kAyQ6P5Vk+mWbSo6D5Fgv1wS6ZiZyKI1FZSMzryLBwv7C7BCRL4d+HLID0RmVlU1jelDwP1A2j7s9/0BeA3Y3te0Ju1/h0s7gn0nubK/TT9l2nQRuegfjv8BPD+knJURAqUAAAAASUVORK5CYII="},a7d6:function(t,i,e){"use strict";e("f257")},d11b:function(t,i,e){},d999:function(t,i,e){t.exports=e.p+"img/saoyisao_btn.be222108.png"},da1d:function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("van-nav-bar",{attrs:{title:t.t_title,fixed:"",border:t.border}},[t._t("left",[e("van-icon",{staticClass:"nav-go",attrs:{name:"arrow-left"},on:{click:t.onClickLeft}})],{slot:"left"}),t._t("title",null,{slot:"title"}),t._t("right",null,{slot:"right"})],2)},n=[],s=e("2939"),o={computed:{t_title:function(){return this.title?this.title:/.*[\u4e00-\u9fa5]+.*$/.test(this.$route.meta.title)?this.$route.meta.title:this.$t("route.".concat(this.$route.meta.title))}},props:{border:{type:Boolean,default:!0},onlyBack:{type:Boolean,default:!1},title:{type:String}},methods:{onClickLeft:function(){this.onlyBack||s["a"].closeWebview(),this.$router.go(-1)}}},r=o,c=(e("a7d6"),e("c701")),u=Object(c["a"])(r,a,n,!1,null,"2f4d49ad",null);i["a"]=u.exports},ea0c:function(t,i,e){"use strict";e("75f0")},f257:function(t,i,e){}}]);